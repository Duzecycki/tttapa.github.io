<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="author" content="Pieter P"/>
    <link rel="stylesheet" type="text/css" href="/CSS/Pages.css"/>
    <link href='/CSS/roboto.css' rel='stylesheet' type='text/css'/>
    <link href='/CSS/icon.css' rel='stylesheet' type='text/css'/>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } },
            "fast-preview": {
            disabled: true
            }
        });
    </script>
    <script type="text/javascript" src="/MathJax/MathJax.js?config=TeX-AMS_SVG"></script>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="theme-color" content="#ccc"/>
    <meta name="keywords" content="cross-compile,raspberry,raspberry pi,build,compile,from source, source,Zlib,OpenSSL,FFI,Bzip2,GNU ncurses,GNU readline,GNU dbm, SQLite,UUID,Python 3.7.4,ZBar,Raspberry Pi Userland,VideoCore, FFmpeg,OpenCV,NumPy"/>
    <meta name="description" content="Using the cross-compilation toolchain to build the libraries you need for your project, as well as their dependencies."/>
    <title>Cross-Compiling the Dependencies</title>
</head>
<body>
    <nav>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="position:absolute;top:4px;right: 4px;">
                <path d="M0 0h48v48h-48z" fill="none"/>
                <path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"/>
            </svg>
            <h2><a href="/">Home</a></h2>
<ul>
    <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../index.html">Raspberry Pi</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Installation+Setup/index.html">Installation and Setup</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../Installation+Setup/Setting-up-Ubuntu.html">Installing and Setting up Ubuntu</a></li>
            <li><span class="ftriangle"></span><a href="../Installation+Setup/WiFi-Setup.html">Setting up the WiFi Connection</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Python-Development/index.html">Python Development</a>
        <ul>
        </ul>
        </li>
        <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="index.html">C++ Development</a>
        <ul>
            <li><span class="ftriangle"></span><a href="Building-The-Toolchain.html">Building the Cross-Compilation Toolchain</a></li>
            <li><span class="ftriangle"></span><a class="openEntry" href="Dependencies.html">Cross-Compiling the Dependencies</a></li>
            <li><span class="ftriangle"></span><a href="Editor-Setup.html">Setting up Visual Studio Code for C++ Development</a></li>
            <li><span class="ftriangle"></span><a href="Cpp-Program.html">Cross-Compiling the C++ Example Project</a></li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/index.html">Arduino</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Audio-and-Signal-Processing/index.html">Audio and Signal Processing</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/index.html">VU Meters</a>
            <ul>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Control-Surface/index.html">Control Surface</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Control-Surface/Developers/index.html">Developers</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Installation.html">Installation</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Style.html">Style</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Tests.html">Tests</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Generating-Documentation.html">Generating Documentation</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Bootloaders/index.html">Bootloaders</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../Arduino/Bootloaders/ATmega328P-custom-frequency.html">Compiling Optiboot - ATmega328P at custom frequency</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/ESP8266/index.html">ESP8266</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/ESP8266/Flashing/index.html">Flashing</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Arduino/ESP8266/Flashing/Flashing-With-an-Arduino.html">Flashing the ESP8266 with an Arduino UNO</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/index.html">Mathematics</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/index.html">Systems and Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/index.html">Analog Filters &amp; Systems</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/Butterworth-Filters.html">Butterworth Filters</a></li>
            </ul>
            </li>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/index.html">Digital Filters &amp; Systems</a>
            <ul>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/index.html">DTLTI Systems, Transfer Functions, and the Z-transform</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/DTLTI-Systems.html">DTLTI Systems</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Impulse-and-Step-Response.html">Impulse and Step Response</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/The-Z-transform.html">The Z-transform</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/index.html">Exponential Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Exponential-Moving-Average.html">Exponential Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Filtering-in-MATLAB.html">Filtering in MATLAB</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/index.html">Simple Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/Simple-Moving-Average.html">Simple Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/index.html">Discretization</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Bilinear-transform.html">Bilinear Transform</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Discretization-of-a-fourth-order-Butterworth-filter.html">Discretization of a Fourth-Order Butterworth Filter</a></li>
                </ul>
                </li>
                <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/FIR-Notch.html">Simple Finite Impulse Response Notch Filter</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/index.html">Ubuntu</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/Software-Installation/index.html">Software Installation</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/Software-Installation/Arduino/index.html">Arduino</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Arduino/Arduino-IDE.html">Arduino IDE</a></li>
                <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Arduino/Hairless-MIDI.html">The Hairless MIDI to Serial Bridge</a></li>
            </ul>
            </li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/BlueZ.html">BlueZ with MIDI over BLE Support</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Doxygen.html">Doxygen</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Eclipse.html">Eclipse</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Java.html">Java</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Python.html">Python</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/VirtualBox.html">VirtualBox</a></li>
        </ul>
        </li>
    </ul>
    </li>
</ul>

            <i class="material-icons">
                <a href="/" title="Home">home</a>
            </i>
            <i class="material-icons">
                <a href="Dependencies.pdf" title="Download as PDF">get_app</a>
            </i>
            <i class="material-icons">
                <a href="javascript:window.print()" title="Print this article">print</a>
            </i>
            <i class="material-icons">
                <a href="https://github.com/tttapa/tttapa.github.io/issues/new" target="_blank" title="Comment or open an issue">report</a>
            </i>
        </div>
    </nav>
    <article>
        <h1 class="title">Cross-Compiling the Dependencies</h1>
        <i class="author">Pieter P</i>
        <div>
<div class="toc" id="toc">
  <script>
  function updateTocSize() {
    let toc = document.getElementById("toc");
    toc.style.maxHeight = toc.scrollHeight + 'px';
  }
  </script>  <h4 class="toc" onclick="if (this.parentElement.classList.toggle('expanded')) {updateTocSize();window.addEventListener('resize', updateTocSize);} else {this.parentElement.style = undefined;window.removeEventListener('resize', updateTocSize);}">Table of Contents <i class="material-icons">list</i></h4>
  <ul>
          <ul>
            <li><a href="#sysroot-and-staging-area">Sysroot and Staging Area</a></li>
            <li><a href="#cross-compiling-the-dependencies-using-the-provided-shell-scripts">Cross-Compiling the dependencies using the provided shell scripts</a></li>
          </ul>
        <li><a href="#detailed-information-about-cross-compilation-of-libraries">Detailed information about cross-compilation of libraries</a></li>
          <ul>
            <li><a href="#base-image">Base Image</a></li>
            <li><a href="#cross-compiling-the-dependencies">Cross-Compiling the dependencies</a></li>
              <ul>
                <li><a href="#preparing-the-sysroot-and-staging-area">Preparing the Sysroot and Staging Area</a></li>
                <li><a href="#compiling-a-library-for-the-docker-container">Compiling a library for the Docker container</a></li>
                <li><a href="#cross-compiling-a-library-for-the-raspberry-pi">Cross-Compiling a library for the Raspberry Pi</a></li>
                  <ul>
                    <li><a href="#downloading-and-extracting">Downloading and extracting</a></li>
                    <li><a href="#pkg-config">pkg-config</a></li>
                    <li><a href="#autoconf">Autoconf</a></li>
                    <li><a href="#configure">Configure</a></li>
                    <li><a href="#compilation">Compilation</a></li>
                    <li><a href="#installation">Installation</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    </ul>
                </ul>
            </ul>
        </ul>
  </ul></div>


<h3><a name="sysroot-and-staging-area" href="#sysroot-and-staging-area">Sysroot and Staging Area</a></h3>

<p>
    Because we don't have access to the actual root directory of the Raspberry Pi, with all of its system files and
    libraries, the toolchain uses a so-called <b>sysroot</b> folder. It contains the necessary system libraries, such as
    glibc and the C++ standard library. It's also the folder where the configure scripts of other libraries will
    look for the necessary libraries and headers. The sysroot is generated by Crosstool-NG, and it is
    part of the cross-compilation toolchain. It is not used for deploying your software to the Pi.
</p>
<p>
    The sysroot of the toolchain is read-only, to keep it clean for future projects, so we'll make a copy of the sysroot
    for this build, and make it writable.<br>
    This copy will be used as the sysroot for all compilations, and all cross-compiled libraries will be installed to
    this folder. We have to do this, because the configure scripts (Autoconf's configure script, CMake, etc.) of other
    libraries or programs will search for their dependencies in the sysroot. If these dependencies are not found,
    configuration or compilation will fail, or parts of the program/library may be implicitly disabled.
</p>
<p>
    Apart from the sysroot, we also need a folder containing the files we want to install to the Pi. It should contain
    the binaries we cross-compiled (such as <code>/usr/local/bin/python3.8</code>) and the necessary libraries (such as
    <code>/usr/local/lib/libpython3.8.so</code>).
    It doesn't contain the system libraries, because the Pi already has these installed. This folder is called the
    <b>staging area</b>.
</p>
<p>
    Having both a sysroot and a staging area means we have to install every library twice, once in
    each of the two folders.<br>
    The sysroot is later used when compiling our program, the staging area will be copied to the Pi for running our
    program.
</p>

<h3><a name="cross-compiling-the-dependencies-using-the-provided-shell-scripts" href="#cross-compiling-the-dependencies-using-the-provided-shell-scripts">Cross-Compiling the dependencies using the provided shell scripts</a></h3>

<p>
    If you just want to build all dependencies and libraries, without you can use the shell scripts provided in the
    <code>toolchain</code> folder:
</p>
<pre class="console">
<code>./toolchain/build-and-export.sh &lt;board&gt;</code>
</pre>

<p>
    Where <code>&lt;board&gt;</code> is one of the following:
    <ul>
        <li><code>rpi</code>: Raspberry Pi 1 or Zero, dependencies only</li>
        <li><code>rpi-dev</code>: Raspberry Pi 1 or Zero, dependencies and development tools</li>
        <li><code>rpi3-armv8</code>: Raspberry Pi 3, 32-bit, dependencies only</li>
        <li><code>rpi3-armv8-dev</code>: Raspberry Pi 3, 32-bit, dependencies and development tools</li>
        <li><code>rpi3-aarch64</code>: Raspberry Pi 3, 64-bit, dependencies only</li>
        <li><code>rpi3-aarch64-dev</code>: Raspberry Pi 3, 64-bit, dependencies and development tools</li>
    </ul>
</p>
<p>
    The dependencies that are cross-compiled are:
    <ul>
        <li><strong>Zlib</strong>: compression library (OpenSSL and Python dependency)</li>
        <li><strong>OpenSSL</strong>: cryptography library (Python dependency)</li>
        <li><strong>FFI</strong>: foreign function interface (Python dependency, used to call C functions using ctypes)
        </li>
        <li><strong>Bzip2</strong>: compression library (Python dependency)</li>
        <li><strong>GNU ncurses</strong>: library for text-based user interfaces (Python dependency, used for the
            console)</li>
        <li><strong>GNU readline</strong>: library for line-editing and history (Python dependency, used for the
            console)</li>
        <li><strong>GNU dbm</strong>: library for key-value data (Python dependency)</li>
        <li><strong>SQLite</strong>: library for embedded databases (Python dependency)</li>
        <li><strong>UUID</strong>: library for unique identifiers (Python dependency)</li>
        <li><strong>Python 3.8.1</strong>: Python interpreter and libraries</li>
        <li><strong>ZBar</strong>: Bar and QR code decoding library</li>
        <li><strong>Raspberry Pi Userland</strong>: VideoCore GPU drivers</li>
        <li><strong>VPX</strong>: VP8/VP9 codec SDK</li>
        <li><strong>x264</strong>: H.264/MPEG-4 AVC encoder</li>
        <li><strong>Xvid</strong>: MPEG-4 video codec</li>
        <li><strong>FFmpeg</strong>: library to record, convert and stream audio and video</li>
        <li><strong>OpenBLAS</strong>: linear algebra library (NumPy dependency)</li>
        <li><strong>NumPy</strong>: multi-dimensional array container for Python (OpenCV dependency)</li>
        <li><strong>SciPy</strong>: Python module for mathematics, science, and engineering</li>
        <li><strong>OpenCV 4.2.0</strong>: computer vision library and Python module</li>
    </ul>
</p>
<p>
    The development tools that are cross-compiled are:
    <ul>
        <li><strong>GCC 9.2.0</strong>: C, C++ and Fortran compilers (see native toolchain on the previous page)</li>
        <li><strong>GNU Make</strong>: build automation tool</li>
        <li><strong>CMake</strong>: build system</li>
        <li><strong>Distcc</strong>: distributed compiler wrapper (uses your computer to speed up compilation on the
            RPi)</li>
        <li><strong>CCache</strong>: compiler cache</li>
        <li><strong>cURL</strong>: tool and library for transferring data over the network (Git dependency)</li>
        <li><strong>Git</strong>: version control system</li>
    </ul>
</p>

<h2><a name="detailed-information-about-cross-compilation-of-libraries" href="#detailed-information-about-cross-compilation-of-libraries">Detailed information about cross-compilation of libraries</a></h2>

<h3><a name="base-image" href="#base-image">Base Image</a></h3>

<p>
    Before building the dependencies, I created a base image with Ubuntu and the
    necessary tools installed. I also created a non-root user.
</p>

<h4 class="snippet-name"><a name="dockerfile" href="#dockerfile">Dockerfile</a></h4>
<div class="codesnippet"><style>.pygments119 .hll { background-color: #ffffcc }
.pygments119  { background: #f8f8f8; }
.pygments119 .c { color: #408080; font-style: italic } /* Comment */
.pygments119 .err { border: 1px solid #FF0000 } /* Error */
.pygments119 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments119 .o { color: #666666 } /* Operator */
.pygments119 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments119 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments119 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments119 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments119 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments119 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments119 .gd { color: #A00000 } /* Generic.Deleted */
.pygments119 .ge { font-style: italic } /* Generic.Emph */
.pygments119 .gr { color: #FF0000 } /* Generic.Error */
.pygments119 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments119 .gi { color: #00A000 } /* Generic.Inserted */
.pygments119 .go { color: #888888 } /* Generic.Output */
.pygments119 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments119 .gs { font-weight: bold } /* Generic.Strong */
.pygments119 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments119 .gt { color: #0044DD } /* Generic.Traceback */
.pygments119 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments119 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments119 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments119 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments119 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments119 .kt { color: #B00040 } /* Keyword.Type */
.pygments119 .m { color: #666666 } /* Literal.Number */
.pygments119 .s { color: #BA2121 } /* Literal.String */
.pygments119 .na { color: #7D9029 } /* Name.Attribute */
.pygments119 .nb { color: #008000 } /* Name.Builtin */
.pygments119 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments119 .no { color: #880000 } /* Name.Constant */
.pygments119 .nd { color: #AA22FF } /* Name.Decorator */
.pygments119 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments119 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments119 .nf { color: #0000FF } /* Name.Function */
.pygments119 .nl { color: #A0A000 } /* Name.Label */
.pygments119 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments119 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments119 .nv { color: #19177C } /* Name.Variable */
.pygments119 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments119 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments119 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments119 .mf { color: #666666 } /* Literal.Number.Float */
.pygments119 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments119 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments119 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments119 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments119 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments119 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments119 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments119 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments119 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments119 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments119 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments119 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments119 .sx { color: #008000 } /* Literal.String.Other */
.pygments119 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments119 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments119 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments119 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments119 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments119 .vc { color: #19177C } /* Name.Variable.Class */
.pygments119 .vg { color: #19177C } /* Name.Variable.Global */
.pygments119 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments119 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments119 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments119 pre.snippet119 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/965f4a2ae674bc013c51429ffe0a21c0ff7e1724/toolchain/docker/base-ubuntu/Dockerfile" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments119"><pre class="lineNumbers snippet119"><code><span></span><span class="k">FROM</span> <span class="s">ubuntu:latest</span> <span class="k">as</span> <span class="s">base-ubuntu</span></code>
<code></code>
<code><span class="c"># Install some tools and compilers + clean up</span></code>
<code><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get install -y sudo git wget <span class="se">\</span></code>
<code>                       gcc g++ cmake make autoconf automake <span class="se">\</span></code>
<code>                       gperf diffutils bzip2 xz-utils <span class="se">\</span></code>
<code>                       flex gawk help2man libncurses-dev patch bison <span class="se">\</span></code>
<code>                       python-dev gnupg2 texinfo unzip libtool-bin <span class="se">\</span></code>
<code>                       autogen libtool m4 gettext pkg-config <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get clean autoclean <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get autoremove -y <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    rm -rf /var/lib/apt/lists/*</code>
<code></code>
<code><span class="c"># Add a user called `develop`, and add him to the sudo group</span></code>
<code><span class="k">RUN</span> useradd -m develop <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    <span class="nb">echo</span> <span class="s2">&quot;develop:develop&quot;</span> <span class="p">|</span> chpasswd <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    adduser develop sudo</code>
<code></code>
<code><span class="k">USER</span><span class="s"> develop</span></code>
<code><span class="k">WORKDIR</span><span class="s"> /home/develop</span></code></pre></div>
</div>

<h3><a name="cross-compiling-the-dependencies" href="#cross-compiling-the-dependencies">Cross-Compiling the dependencies</a></h3>

<p>
    If you want to write a program that uses the OpenCV library, you have to cross-compile OpenCV and install it to
    the Raspberry Pi. But in order to cross-compile OpenCV itself, you need to cross-compile all of its dependencies as
    well. This can keep going for a while, and you may end up with a pretty large hierarchy of dependencies.
</p>
<p>
    The main Dockerfile discussed below sets up the build environment, and then runs the installation scripts in the
    <a
        href="https://github.com/tttapa/RPi-Cpp-Toolchain/tree/master/toolchain/docker/rpi3/aarch64/aarch64-cross-build/install-scripts"><code>toolchain/docker/rpi3/aarch64/aarch64-cross-build/install-scripts</code></a>
    folder. If you want to omit some of the libraries, you can comment them out in the Dockerfile, but keep in mind that
    it might break other libraries that depend on it.<br>
    Some libraries such as SciPy need to be patched to get them to cross-compile correctly. These patches can be found
    in the <a
        href="https://github.com/tttapa/RPi-Cpp-Toolchain/tree/master/toolchain/docker/rpi3/aarch64/aarch64-cross-build/patches"><code>patches</code></a>
    folder.
</p>
<p>
    For most packages, the build procedure is very simple:
    <ol>
        <li>Download</li>
        <li>Extract</li>
        <li>Run the <code>configure</code> script with the right options</li>
        <li><code>make</code></li>
        <li><code>make install</code></li>
    </ol>
    An example is given below.
</p>

<h4><a name="preparing-the-sysroot-and-staging-area" href="#preparing-the-sysroot-and-staging-area">Preparing the Sysroot and Staging Area</a></h4>

<h4 class="snippet-name"><a name="dockerfile1" href="#dockerfile1">Dockerfile</a></h4>
<div class="codesnippet"><style>.pygments156 .hll { background-color: #ffffcc }
.pygments156  { background: #f8f8f8; }
.pygments156 .c { color: #408080; font-style: italic } /* Comment */
.pygments156 .err { border: 1px solid #FF0000 } /* Error */
.pygments156 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments156 .o { color: #666666 } /* Operator */
.pygments156 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments156 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments156 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments156 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments156 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments156 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments156 .gd { color: #A00000 } /* Generic.Deleted */
.pygments156 .ge { font-style: italic } /* Generic.Emph */
.pygments156 .gr { color: #FF0000 } /* Generic.Error */
.pygments156 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments156 .gi { color: #00A000 } /* Generic.Inserted */
.pygments156 .go { color: #888888 } /* Generic.Output */
.pygments156 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments156 .gs { font-weight: bold } /* Generic.Strong */
.pygments156 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments156 .gt { color: #0044DD } /* Generic.Traceback */
.pygments156 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments156 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments156 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments156 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments156 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments156 .kt { color: #B00040 } /* Keyword.Type */
.pygments156 .m { color: #666666 } /* Literal.Number */
.pygments156 .s { color: #BA2121 } /* Literal.String */
.pygments156 .na { color: #7D9029 } /* Name.Attribute */
.pygments156 .nb { color: #008000 } /* Name.Builtin */
.pygments156 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments156 .no { color: #880000 } /* Name.Constant */
.pygments156 .nd { color: #AA22FF } /* Name.Decorator */
.pygments156 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments156 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments156 .nf { color: #0000FF } /* Name.Function */
.pygments156 .nl { color: #A0A000 } /* Name.Label */
.pygments156 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments156 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments156 .nv { color: #19177C } /* Name.Variable */
.pygments156 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments156 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments156 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments156 .mf { color: #666666 } /* Literal.Number.Float */
.pygments156 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments156 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments156 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments156 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments156 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments156 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments156 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments156 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments156 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments156 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments156 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments156 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments156 .sx { color: #008000 } /* Literal.String.Other */
.pygments156 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments156 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments156 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments156 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments156 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments156 .vc { color: #19177C } /* Name.Variable.Class */
.pygments156 .vg { color: #19177C } /* Name.Variable.Global */
.pygments156 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments156 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments156 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments156 pre.snippet156 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/8cf020039991abfbb39b8a037ae794197f763715/toolchain/docker/rpi3/aarch64/aarch64-cross-build/Dockerfile#L1-L26" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments156"><pre class="lineNumbers snippet156"><code><span></span><span class="k">FROM</span> <span class="s">base-ubuntu</span> <span class="k">as</span> <span class="s">python-opencv-build</span></code>
<code></code>
<code><span class="c"># Set the path to the toolchain executables</span></code>
<code><span class="k">ENV</span> <span class="nv">HOST_CPU</span><span class="o">=</span><span class="s2">&quot;CORTEXA53&quot;</span></code>
<code><span class="k">ENV</span> <span class="nv">HOST_ARCH</span><span class="o">=</span><span class="s2">&quot;aarch64&quot;</span></code>
<code><span class="k">ENV</span> <span class="nv">HOST_TRIPLE</span><span class="o">=</span><span class="s2">&quot;aarch64-rpi3-linux-gnu&quot;</span></code>
<code><span class="k">ENV</span> <span class="nv">TOOLCHAIN_PATH</span><span class="o">=</span><span class="s2">&quot;/home/develop/x-tools/</span><span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">TOOLCHAIN_PATH</span><span class="si">}</span><span class="s2">/bin&quot;</span></code>
<code><span class="k">ENV</span> <span class="nv">DOWNLOADS</span><span class="o">=</span><span class="s2">&quot;/tmp/downloads&quot;</span></code>
<code></code>
<code><span class="c"># Copy the toolchain from the previous Docker image</span></code>
<code><span class="k">COPY</span> --from<span class="o">=</span>aarch64-cross-toolchain <span class="se">\</span></code>
<code>    /home/develop/x-tools/<span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span> <span class="se">\</span></code>
<code>    <span class="si">${</span><span class="nv">TOOLCHAIN_PATH</span><span class="si">}</span></code>
<code></code>
<code><span class="c"># Create a sysroot and staging area for the RPi</span></code>
<code><span class="k">WORKDIR</span><span class="s"> /home/develop</span></code>
<code><span class="k">ENV</span> <span class="nv">RPI3_SYSROOT</span><span class="o">=</span>/home/develop/RPi-sysroot</code>
<code><span class="k">ENV</span> <span class="nv">RPI3_STAGING</span><span class="o">=</span>/home/develop/RPi-staging</code>
<code><span class="k">RUN</span> mkdir RPi-sysroot <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    cp -rp <span class="nv">$TOOLCHAIN_PATH</span>/<span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span>/sysroot/* ~/RPi-sysroot/ <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    chmod -R u+w /home/develop/RPi-sysroot</code>
<code></code>
<code><span class="k">RUN</span> mkdir -p <span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOADS</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code><span class="k">COPY</span> --chown<span class="o">=</span>develop:develop tools/ ./tools/</code>
<code><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/home/develop/tools:</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">&quot;</span></code></pre></div>
</div>

<h4><a name="compiling-a-library-for-the-docker-container" href="#compiling-a-library-for-the-docker-container">Compiling a library for the Docker container</a></h4>

<p>
    In the first section of the main Dockerfile, most packages are built for both the build machine (the Docker
    container) and for the host machine (the Raspberry Pi), because we need to build Python for both machines in order
    to cross-compile the OpenCV and NumPy modules later on.
</p>
<p>
    Since these are just basic native installations, you can simply follow the documentation for the library in
    question.
    All of the necessary tools should be installed in the <a href="#base-image">base image</a>.
</p>

<h4><a name="cross-compiling-a-library-for-the-raspberry-pi" href="#cross-compiling-a-library-for-the-raspberry-pi">Cross-Compiling a library for the Raspberry Pi</a></h4>

<p>
    Cross-compiling is a bit harder, because most libraries don't provide good documentation about cross-compilation.
    However, once you understand the concepts, you'll be able to apply them to almost any library.
</p>
<p>
    We'll have a look at a typical example, compiling <code>libffi</code>, a foreign function interface library
    that is used by Python's <code>ctypes</code> module.
</p>

<h4 class="snippet-name"><a name="libffi-sh" href="#libffi-sh">libffi.sh</a></h4>
<div class="codesnippet"><style>.pygments186 .hll { background-color: #ffffcc }
.pygments186  { background: #f8f8f8; }
.pygments186 .c { color: #408080; font-style: italic } /* Comment */
.pygments186 .err { border: 1px solid #FF0000 } /* Error */
.pygments186 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments186 .o { color: #666666 } /* Operator */
.pygments186 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments186 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments186 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments186 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments186 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments186 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments186 .gd { color: #A00000 } /* Generic.Deleted */
.pygments186 .ge { font-style: italic } /* Generic.Emph */
.pygments186 .gr { color: #FF0000 } /* Generic.Error */
.pygments186 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments186 .gi { color: #00A000 } /* Generic.Inserted */
.pygments186 .go { color: #888888 } /* Generic.Output */
.pygments186 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments186 .gs { font-weight: bold } /* Generic.Strong */
.pygments186 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments186 .gt { color: #0044DD } /* Generic.Traceback */
.pygments186 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments186 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments186 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments186 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments186 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments186 .kt { color: #B00040 } /* Keyword.Type */
.pygments186 .m { color: #666666 } /* Literal.Number */
.pygments186 .s { color: #BA2121 } /* Literal.String */
.pygments186 .na { color: #7D9029 } /* Name.Attribute */
.pygments186 .nb { color: #008000 } /* Name.Builtin */
.pygments186 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments186 .no { color: #880000 } /* Name.Constant */
.pygments186 .nd { color: #AA22FF } /* Name.Decorator */
.pygments186 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments186 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments186 .nf { color: #0000FF } /* Name.Function */
.pygments186 .nl { color: #A0A000 } /* Name.Label */
.pygments186 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments186 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments186 .nv { color: #19177C } /* Name.Variable */
.pygments186 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments186 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments186 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments186 .mf { color: #666666 } /* Literal.Number.Float */
.pygments186 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments186 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments186 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments186 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments186 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments186 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments186 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments186 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments186 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments186 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments186 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments186 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments186 .sx { color: #008000 } /* Literal.String.Other */
.pygments186 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments186 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments186 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments186 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments186 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments186 .vc { color: #19177C } /* Name.Variable.Class */
.pygments186 .vg { color: #19177C } /* Name.Variable.Global */
.pygments186 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments186 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments186 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments186 pre.snippet186 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/2956294734425ae568d882d95fd2f9efb97a3873/toolchain/docker/rpi3/aarch64/aarch64-cross-build/install-scripts/libffi.sh" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments186"><pre class="lineNumbers snippet186"><code><span></span><span class="ch">#!/usr/bin/env bash</span></code>
<code></code>
<code><span class="nb">set</span> -ex</code>
<code></code>
<code><span class="c1"># Download</span></code>
<code><span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://codeload.github.com/libffi/libffi/tar.gz/v3.2.1&quot;</span></code>
<code><span class="nb">pushd</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOADS</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code>wget -N <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> -O libffi-3.2.1.tar.gz</code>
<code><span class="nb">popd</span></code>
<code></code>
<code><span class="c1"># Extract</span></code>
<code>tar xzf <span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOADS</span><span class="si">}</span><span class="s2">/libffi-3.2.1.tar.gz&quot;</span></code>
<code><span class="nb">pushd</span> libffi-3.2.1</code>
<code></code>
<code><span class="c1"># Configure</span></code>
<code>. cross-pkg-config</code>
<code>./autogen.sh</code>
<code>./configure <span class="se">\</span></code>
<code>    --host<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span></code>
<code>    --prefix<span class="o">=</span><span class="s2">&quot;/usr/local&quot;</span> <span class="se">\</span></code>
<code>    <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-O2&quot;</span> <span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;-O2&quot;</span> <span class="se">\</span></code>
<code>    --with-sysroot<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI3_SYSROOT</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code></code>
<code><span class="c1"># Build</span></code>
<code>make -j<span class="k">$(($(</span>nproc<span class="k">)</span> <span class="o">*</span> <span class="m">2</span><span class="k">))</span></code>
<code></code>
<code><span class="c1"># Install</span></code>
<code>make install <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI3_SYSROOT</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code>make install <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI3_STAGING</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code></code>
<code><span class="c1"># Cleanup</span></code>
<code><span class="nb">popd</span></code>
<code>rm -rf libffi-3.2.1</code></pre></div>
</div>

<h5><a name="downloading-and-extracting" href="#downloading-and-extracting">Downloading and extracting</a></h5>
<p>
    The first couple of lines are really straightforward, they simply download the library from GitHub, extract it, and
    enter the library's directory.
</p>
<h5><a name="pkg-config" href="#pkg-config">pkg-config</a></h5>
<p>
    Most configure scripts use <code>pkg-config</code>, a simple tool to find libraries that are installed on the
    system, and to determine what flags are necessary to use them. We want <code>pkg-config</code> to find the libraries
    in the Raspberry Pi sysroot, not in the root folder of the Docker container, because these libraries are for the
    wrong architecture.<br>
    The <code>cross-pkg-config</code> script that is sourced on line 16 sets some environment variables in order to tell
    <code>pkg-config</code> to only search for libraries in the Raspberry Pi sysroot.
</p>
<h5><a name="autoconf" href="#autoconf">Autoconf</a></h5>
<p>
    Many older libraries use GNU Autoconf to configure the project before building. Autoconf generates the
    <code>configure</code> script, and then the <code>configure</code> script generates the makefiles that are used to
    actually compile and install the software. When downloading a library directly from GitHub (or other source control
    host), you usually have to run Autoconf before configuring. If you download a released tarball from the project's
    website, this isn't usually required.
</p>
<h5><a name="configure" href="#configure">Configure</a></h5>
<p>
    The <code>configure</code> script checks the system configuration, looks for libraries, and generates the
    makefiles.<br>
    We have to specify that we are cross-compiling by providing the <code>--host</code> flag. As mentioned before, the
    <code>--prefix</code> option specifies the directory where the library will be installed on the Raspberry Pi.
    Software that isn't managed by the system's package manager should be installed to <code>/usr/local</code>.<br>
    You can add your own compiler flags if you want, using the <code>CFLAGS</code>, <code>CXXFLAGS</code> and
    <code>LDFLAGS</code> variables. Finally, we tell the configure script to use our custom sysroot, instead of the
    toolchain's default. Some configure scripts don't support this. In that case, you can add the
    <code>--sysroot="..."</code> option to the <code>CFLAGS</code>, <code>CXXFLAGS</code> and <code>LDFLAGS</code>
    variables.
</p>
<p>
    To find out what options you can pass to the <code>configure</code> script, you can run
    <code>./configure --help</code>.
    Usually, a library also comes with some documentation about these options, for example in the <code>README</code> or
    <code>INSTALL</code> documents.
</p>
<h5><a name="compilation" href="#compilation">Compilation</a></h5>
<p>
    This is probably the easiest step, you can simply type <code>make</code> to compile everyting. To speed up the
    build, <code>make</code>'s <code>-j</code> (<code>--jobs</code>) option is used to compile multiple source files in
    parallel. <code>nproc</code> returns the number of available processing units (cores/threads) in your computer.
    It's multiplied by two, and then passed to <code>make</code>.
</p>
<h5><a name="installation" href="#installation">Installation</a></h5>
<p>
    Once everything has been compiled, we'll install everything in the sysroot and in the staging area. When running
    <code>make install DESTDIR="..."</code>, the files will be installed <code>DESTDIR/PREFIX</code>, that is, the
    <code>DESTDIR</code> variable passed to <code>make</code> and the <code>--prefix</code> specified during
    configuration will be concatenated. The prefix matters both during compilation/installation and at runtime,
    the <code>DESTDIR</code> just determines where they are installed, and is not used at runtime.<br>
    The <code>DESTDIR</code> variable also makes it very easy to install the package at two locations, the sysroot
    and the staging area without building the package twice.
</p>
<h5><a name="cleanup" href="#cleanup">Cleanup</a></h5>
<p>
    Finally, we just delete the entire build directory to keep the size of the Docker image low.
</p>

</div>
        <hr id="end-of-article">
        <div class="nextupprev"><div class="prevpage"><a href="Building-The-Toolchain.html" title="Building the Cross-Compilation Toolchain">ᐊ Previous Page</a></div><div class="uppage"><a href="index.html" title="C++ Development">Index</a></div><div class="nextpage"><a href="Editor-Setup.html" title="Setting up Visual Studio Code for C++ Development">Next Page ᐅ</a></div></div>
    </article>
    <footer>Last edited: Monday, 16 March 2020 22:30 UTC</footer>
</body>

</html>